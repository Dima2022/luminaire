<!DOCTYPE html>
<html lang="en" >
<head>
    <meta charset="utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <title>Configuration Optimization</title>
    

    <link rel="stylesheet" href="../_static/css/redactor.css" type="text/css" />
    
    <link rel="stylesheet" href="../_static/logo.css" type="text/css" />
    
    
    <link rel="index" title="Index" href="../genindex.html"/>
    <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="luminaire 0.1.0 documentation" href="../index.html"/>
    <link rel="up" title="Tutorials" href="tutorials.html"/>
    <link rel="next" title="Outlier Detection" href="outlier_batch.html"/>
    <link rel="prev" title="Data Profiling" href="dataprofiling.html"/> 
</head>

<body role="document">
     

    
<a href="#" id="js-navigation-toggle" class="navigation-toggle">
    <i class="mdi mdi-menu"></i><i class="mdi mdi-close"></i>
</a>

<section class="site-sidebar">

<nav>


    <a href="../index.html" class="branding-link">
    
    
    
        <img src="../_static/luminaire_logo.png" class="logo" />
    
    
        
        
    
    </a>

    
<section role="search">
    <form action="../search.html" method="get" class="site-searchform">
        <input type="text" name="q" placeholder="Search docs" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
</section>



    <section class="site-nav">
    
    
        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="dataprofiling.html">Data Profiling</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Configuration Optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fully-automatic-outlier-detection">Fully Automatic Outlier Detection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="outlier_batch.html">Outlier Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="streaming.html">Anomaly Detection for Streaming data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/user_guide.html">User Guide</a></li>
</ul>

    
    </section>

</nav>

</section>

    <main class="site-main" role="main">
        











<nav class="site-breadcrumbs">
    <ul>
    
        <li>
            <a href="../index.html">Docs</a> /
        </li>
        
        <li>
            <a href="tutorials.html">Tutorials</a> /
        </li>
        
        <li class="site-breadcrumbs__leaf">Configuration Optimization</li>
    
    </ul>
</nav>
        <section class="site-content">
            <div class="container">
                
  <div class="section" id="configuration-optimization">
<h1>Configuration Optimization<a class="headerlink" href="#configuration-optimization" title="Permalink to this headline">¶</a></h1>
<p>Luminaire <em>HyperparameterOptimization</em> performs auto-selection of the best data preprocessing configuration and the outlier detection model training configuration with respect to the input time series. This option enables Luminaire to work as a hands-off system where the user only has to provide the input data along with its frequency. This option should be used if the user wants avoid any manual configuration and should be called prior to the data pre-processing and training steps.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">luminaire.optimization.hyperparameter_optimization</span> <span class="kn">import</span> <span class="n">HyperparameterOptimization</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">               raw</span>
<span class="go">index</span>
<span class="go">2020-01-01  1326.0</span>
<span class="go">2020-01-02  1552.0</span>
<span class="go">2020-01-03  1432.0</span>
<span class="go">2020-01-04  1470.0</span>
<span class="go">2020-01-05  1565.0</span>
<span class="gp">... </span>            <span class="o">...</span>
<span class="go">2020-06-03  1934.0</span>
<span class="go">2020-06-04  1873.0</span>
<span class="go">2020-06-05  1674.0</span>
<span class="go">2020-06-06  1747.0</span>
<span class="go">2020-06-07  1782.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hopt_obj</span> <span class="o">=</span> <span class="n">HyperparameterOptimization</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">opt_config</span> <span class="o">=</span> <span class="n">hopt_obj</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">opt_config</span><span class="p">)</span>
<span class="go">{&#39;LuminaireModel&#39;: &#39;LADStructuralModel&#39;, &#39;data_shift_truncate&#39;: 0, &#39;fill_rate&#39;: 0.742353444620679, &#39;include_holidays_exog&#39;: 1, &#39;is_log_transformed&#39;: 1, &#39;max_ft_freq&#39;: 2, &#39;p&#39;: 1, &#39;q&#39;: 1}</span>
</pre></div>
</div>
<div class="section" id="fully-automatic-outlier-detection">
<h2>Fully Automatic Outlier Detection<a class="headerlink" href="#fully-automatic-outlier-detection" title="Permalink to this headline">¶</a></h2>
<p>Since the optimized configuration contains all the parameters required for data pre-processing and training, this can be used downstream for performing the data pre-processing and training.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">luminaire.exploration.data_exploration</span> <span class="kn">import</span> <span class="n">DataExploration</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">de_obj</span> <span class="o">=</span> <span class="n">DataExploration</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">opt_config</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">training_data</span><span class="p">,</span> <span class="n">pre_prc</span> <span class="o">=</span> <span class="n">de_obj</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">training_data</span><span class="p">)</span>
<span class="go">                raw  interpolated</span>
<span class="go">2020-01-01  1326.0      7.190676</span>
<span class="go">2020-01-02  1552.0      7.347943</span>
<span class="go">2020-01-03  1432.0      7.267525</span>
<span class="go">2020-01-04  1470.0      7.293697</span>
<span class="go">2020-01-05  1565.0      7.356279</span>
<span class="gp">... </span>           <span class="o">...</span>           <span class="o">...</span>
<span class="go">2020-06-03  1934.0      7.567862</span>
<span class="go">2020-06-04  1873.0      7.535830</span>
<span class="go">2020-06-05  1674.0      7.423568</span>
<span class="go">2020-06-06  1747.0      7.466227</span>
<span class="go">2020-06-07  1782.0      7.486052</span>
</pre></div>
</div>
<p>The above piece of code makes the data ready to be ingested for training. The only step left before training is to extract the luminaire outlier detection model object for the optimized configuration.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model_class_name</span> <span class="o">=</span> <span class="n">opt_config</span><span class="p">[</span><span class="s1">&#39;LuminaireModel&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;luminaire.model&#39;</span><span class="p">,</span> <span class="n">fromlist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">model_class_name</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
<span class="go">&lt;class &#39;luminaire_models.model.lad_structural.LADStructuralModel&#39;&gt;</span>
</pre></div>
</div>
<p>Since, we have to optimal model class along with other optimal configurations, we can run training as follows:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model_object</span> <span class="o">=</span> <span class="n">model_class</span><span class="p">(</span><span class="n">hyper_params</span><span class="o">=</span><span class="n">opt_config</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">success</span><span class="p">,</span> <span class="n">model_date</span><span class="p">,</span> <span class="n">trained_model</span> <span class="o">=</span> <span class="n">model_object</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">training_data</span><span class="p">,</span> <span class="o">**</span><span class="n">pre_prc</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">model_date</span><span class="p">,</span> <span class="n">trained_model</span><span class="p">)</span>
<span class="go">(True, &#39;2020-06-07 00:00:00&#39;, &lt;luminaire_models.model.lad_structural.LADStructuralModel object at 0x7fe2b47a7978&gt;)</span>
</pre></div>
</div>
<p>This trained model is now ready to be used for scoring future data points.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">trained_model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="s1">&#39;2020-06-08&#39;</span><span class="p">)</span>
<span class="go">{&#39;Success&#39;: True, &#39;IsLogTransformed&#39;: 1, &#39;LogTransformedAdjustedActual&#39;: 7.601402334583733, &#39;LogTransformedPrediction&#39;: 7.529710533463001, &#39;LogTransformedStdErr&#39;: 0.06217883425408564, &#39;LogTransformedCILower&#39;: 7.422390543346913, &#39;LogTransformedCIUpper&#39;: 7.62662106869458, &#39;AdjustedActual&#39;: 2000.000000000015, &#39;Prediction&#39;: 1861.566274906425, &#39;StdErr&#39;: 110.9167321105633, &#39;CILower&#39;: 1672.028177505716, &#39;CIUpper&#39;: 2051.104372307134, &#39;ConfLevel&#39;: 90.0, &#39;ExogenousHolidays&#39;: 0, &#39;IsAnomaly&#39;: False, &#39;IsAnomalyExtreme&#39;: False, &#39;AnomalyProbability&#39;: 0.7545715087682185, &#39;DownAnomalyProbability&#39;: 0.12271424561589073, &#39;UpAnomalyProbability&#39;: 0.8772857543841093, &#39;ModelFreshness&#39;: 0.1}</span>
</pre></div>
</div>
</div>
</div>


            </div>

        </section>

        
            <nav class="site-bottom-navigation" role="navigation">
            
                <a href="outlier_batch.html" class="btn btn--primary btn--next right"
                    title="Outlier Detection" accesskey="n">
                    Next
                </a>
            
            
                <a href="dataprofiling.html" class="btn btn--primary btn--prev"
                    title="Data Profiling" accesskey="p">
                    Previous
                </a>
            
            </nav>
        

        
            <div class="source-link">
            
                
                    <a href="../_sources/basic_usage_tutorial/optimization.rst.txt" rel="nofollow">
                        <i class="mdi mdi-code-tags"></i>
                        View page source
                    </a>
                
            
            </div>
        



    </main>

    <footer class="site-footer">
<div class="container">

    <div role="contentinfo">
        <p>
                &copy; Copyright 2020 Zillow, Inc..
        </p>
    </div>
        <p>Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
        <a href="https://github.com/testthedocs/sphinx_ttd_theme">theme</a>
        provided by <a href="https://testthedocs">TestTheDocs</a>. 

</div>
</footer>

    

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/js/theme-min.js"></script>
<!-- for adding github fork icon, reference: https://github.com/tholman/github-corners -->
<a href="https://github.com/zillow/luminaire" class="github-corner" aria-label="View source on GitHub">
    <svg width="150" height="150" viewBox="0 0 250 250" style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
    </svg>
</a>

<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
     

</body>
</html>